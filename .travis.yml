sudo: false

services: docker

language: node_js

node_js: 10

cache:
  directories:
    - "node_modules"

addons:
  hosts: argos.local

install:
- docker pull couchdb
- docker run -d -p 5984:5984 couchdb
- npm install
- curl -X PUT localhost:5984/argos
- curl -X PUT -d '"false"' localhost:5984/_node/_local/_config/httpd/secure_rewrites
- curl -X PUT -d '"/argos/_design/argos/_rewrite"' localhost:5984/_node/_local/_config/vhosts/argos.local
- pip install --user couchapp
- couchapp pushdocs __tests__/api/fixtures  http://localhost:5984/argos
- couchapp push app http://localhost:5984/argos

script: npm test
